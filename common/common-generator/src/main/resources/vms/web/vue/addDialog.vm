<script lang="ts" setup>
import ${className}Dialog from '${vuePath}${lowerHyphen}-dialog.vue';
import { reactive } from 'vue';
import { ElMessage, FormInstance } from 'element-plus';
import { $t } from '@/plugins/i18n';
import type { FileDetails } from '@/types/common/file';
import { use${className}Store } from '${storePath}${lowercaseName}';
import { ${className}AddDto, ${className}State, ${className}UpdateDto } from '${storeTypePath}${lowercaseName}';

const ${storeId}Store = use${className}Store();
const form = reactive<${className}AddDto>({});

/**
 * * 关闭弹窗
 */
const onClose = () => {
	const data = {

	};
	Object.assign(form, data);
	${storeId}Store.addDialogVisible = false;
};

/**
 * * 提交表单
 */
const onSubmit = (formEl: FormInstance | undefined) => {
	if (!formEl) return;
	formEl.validate(async valid => {
		if (valid) {
			// 添加内容
			const result = await ${storeId}Store.add${className}(form);
			if (!result) return false;

			// 添加成功后刷新数据
			${storeId}Store.addDialogVisible = false;
			await ${storeId}Store.get${className}List();
		} else {
			ElMessage.closeAll();
			ElMessage.warning($t('status.requiredFields'));
		}
	});
};

#foreach($item in $addDtoFormList)
    #if($item.name == 'avatar')
    	/**
		 * * 图片上传成功回调
		 * @param fileDetails
		 */
		const onUploadImage = (fileDetails: FileDetails) => {
			form.avatar = fileDetails.filepath;
		};
    #end
    #if($item.name == 'image')
    	/**
		 * * 图片上传成功回调
		 * @param fileDetails
		 */
		const onUploadImage = (fileDetails: FileDetails) => {
			form.image = fileDetails.filepath;
		};
    #end
#end


</script>

<template>
	<${lowerHyphen}-dialog :form="form" :on-close="onClose" :on-submit="onSubmit"
#foreach($item in $addDtoFormList)
    #if($item.name == 'avatar' || $item.name == 'image')
		:on-upload-callback="onUploadImage"
    #end
#end
	:visible="${storeId}Store.addDialogVisible" title="添加信息" />
</template>
